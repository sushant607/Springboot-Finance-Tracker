<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Transactions - Personal Finance Tracker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container">
    <a class="navbar-brand" href="/"><i class="fas fa-chart-line me-2"></i>Finance Tracker</a>
    <div class="navbar-nav ms-auto">
      <a class="nav-link" href="/">Dashboard</a>
      <a class="nav-link active" href="/transactions">Transactions</a>
      <a class="nav-link" href="/budgets">Budgets</a>
      <a class="nav-link" href="/logout">Logout</a>
    </div>
  </div>
</nav>

<!-- Main Content -->
<div class="container mt-4">
  <h1><i class="fas fa-exchange-alt me-2"></i>Transactions</h1>

  <!-- Success/Error Messages -->
  <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
    <span th:text="${success}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>

  <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
    <span th:text="${error}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>

  <!-- Add New Transaction Form -->
  <div class="card mb-4">
    <div class="card-header">
      <h5><i class="fas fa-plus me-2"></i>Add New Transaction</h5>
    </div>
    <div class="card-body">
      <form th:action="@{/transactions}" th:object="${newTransaction}" method="post">
        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label for="description" class="form-label">Description</label>
              <input type="text"
                     class="form-control"
                     th:class="${#fields.hasErrors('description')} ? 'form-control is-invalid' : 'form-control'"
                     id="description"
                     th:field="*{description}"
                     placeholder="Enter transaction description"
                     required>
              <div th:if="${#fields.hasErrors('description')}"
                   class="invalid-feedback"
                   th:errors="*{description}"></div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="mb-3">
              <label for="amount" class="form-label">Amount</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number"
                       step="0.01"
                       min="0"
                       class="form-control"
                       th:class="${#fields.hasErrors('amount')} ? 'form-control is-invalid' : 'form-control'"
                       id="amount"
                       th:field="*{amount}"
                       placeholder="0.00"
                       required>
                <div th:if="${#fields.hasErrors('amount')}"
                     class="invalid-feedback"
                     th:errors="*{amount}"></div>
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="mb-3">
              <label for="type" class="form-label">Type</label>
              <select class="form-select"
                      th:class="${#fields.hasErrors('type')} ? 'form-select is-invalid' : 'form-select'"
                      id="type"
                      th:field="*{type}"
                      required>
                <option value="">Select Type</option>
                <option th:each="type : ${transactionTypes}"
                        th:value="${type}"
                        th:text="${type}"></option>
              </select>
              <div th:if="${#fields.hasErrors('type')}"
                   class="invalid-feedback"
                   th:errors="*{type}"></div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label for="category" class="form-label">Category</label>
              <select class="form-select"
                      th:class="${#fields.hasErrors('category')} ? 'form-select is-invalid' : 'form-select'"
                      id="category"
                      th:field="*{category}"
                      required>
                <option value="">Select Category</option>
                <option th:each="cat : ${categories}"
                        th:value="${cat}"
                        th:text="${cat}"></option>
              </select>
              <div th:if="${#fields.hasErrors('category')}"
                   class="invalid-feedback"
                   th:errors="*{category}"></div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="mb-3">
              <label for="date" class="form-label">Date</label>
              <input type="date"
                     class="form-control"
                     th:class="${#fields.hasErrors('date')} ? 'form-control is-invalid' : 'form-control'"
                     id="date"
                     th:field="*{date}">
              <div th:if="${#fields.hasErrors('date')}"
                   class="invalid-feedback"
                   th:errors="*{date}"></div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="mb-3">
              <label class="form-label">&nbsp;</label>
              <button type="submit" class="btn btn-primary w-100">
                <i class="fas fa-plus me-1"></i>Add Transaction
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Transactions List -->
  <div class="card">
    <div class="card-header">
      <h5><i class="fas fa-list me-2"></i>Recent Transactions</h5>
    </div>
    <div class="card-body">
      <div th:if="${#lists.isEmpty(transactions)}" class="text-center py-4">
        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
        <p class="text-muted">No transactions found. Add your first transaction above!</p>
      </div>

      <div th:if="${!#lists.isEmpty(transactions)}" class="table-responsive">
        <table class="table table-hover">
          <thead class="table-light">
          <tr>
            <th>Date</th>
            <th>Description</th>
            <th>Category</th>
            <th>Amount</th>
            <th>Type</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="transaction : ${transactions}">
            <td th:text="${#temporals.format(transaction.date, 'MMM dd, yyyy')}"></td>
            <td th:text="${transaction.description}"></td>
            <td>
              <span class="badge bg-secondary" th:text="${transaction.category}"></span>
            </td>
            <td>
              <strong th:text="'$' + ${#numbers.formatDecimal(transaction.amount, 1, 2)}"></strong>
            </td>
            <td>
                                    <span th:class="${transaction.type == 'INCOME'} ? 'badge bg-success' : 'badge bg-danger'"
                                          th:text="${transaction.type}">
                                    </span>
            </td>
            <td>
              <div class="btn-group btn-group-sm" role="group">
                <a th:href="@{/transactions/edit/{id}(id=${transaction.id})}"
                   class="btn btn-outline-primary btn-sm">
                  <i class="fas fa-edit"></i>
                </a>
                <form th:action="@{/transactions/delete/{id}(id=${transaction.id})}"
                      method="post"
                      style="display: inline;"
                      onsubmit="return confirm('Are you sure you want to delete this transaction?')">
                  <button type="submit" class="btn btn-outline-danger btn-sm">
                    <i class="fas fa-trash"></i>
                  </button>
                </form>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
        // Set today's date as default
        document.addEventListener('DOMContentLoaded', function() {
            const dateInput = document.getElementById('date');
            if (!dateInput.value) {
                dateInput.value = new Date().toISOString().split('T')[0];
            }
        });
    </script>
</body>
</html>
